<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>


    <meta name="description" content="Personal blog for Matt Atkinson, discusing frontend and backend technologies." />



  <meta name="keywords" content="dev,development,engineering,javascript,nodejs" />



  <link rel="alternate" href="/atom.xml" title="Matt Atkinson" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    analytics: {
      google: 'UA-64837207-1'
    },
    sidebar: 'hide'
  };
</script>




  <title> Matt Atkinson </title>
</head>

<body>
  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->

  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Matt Atkinson</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<div class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/">
            <i class="menu-item-icon icon-home"></i> <br />
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            <i class="menu-item-icon icon-about"></i> <br />
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            <i class="menu-item-icon icon-archives"></i> <br />
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            <i class="menu-item-icon icon-tags"></i> <br />
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-feed">
          <a href="/atom.xml">
            <i class="menu-item-icon icon-feed"></i> <br />
            RSS
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
<form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 's6XmJ-5v9_CYmSCNc-yB','2.0.0');
</script>

<div class="site-search-toggle"></div>
    </div>
  
</div>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <div id="posts" class="posts-expand">
    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/08/07/How-to-schedule-jobs-in-NodeJS/">
                How to schedule jobs in your Node.js service
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on 2015-08-07
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/08/07/How-to-schedule-jobs-in-NodeJS/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/08/07/How-to-schedule-jobs-in-NodeJS/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>When dealing with large applications there are a lot of cases where you need some sort of scheduled task or cron job. Modifying these and redeploying them can be a pain as they are separate from your service/code. In addition, making sure the correct version of your software and the cron jobs are running on the right servers can add headache to troubleshooting.</p>
<p>Since your NodeJS service is an always running process, and you have things like setTimeout and setInterval at your disposal, setting these up in your NodeJS service can solve all these problems. Additionally, since you already have all your models set up, doing cleanup tasks on your databases or caches are a breeze.</p>
<p>While developing these tasks, I realized that if and when I cluster these services, I will run into an issue where multiple tasks will run at the same time, and this was not a good thing. I searched for a while for a solution but I could not find anything, so I decided to write it myself.</p>
<h2 id="is-master">is-master</h2><p><a href="https://www.npmjs.com/package/is-master" target="_blank" rel="external">https://www.npmjs.com/package/is-master</a><br><a href="https://github.com/mattpker/node-is-master" target="_blank" rel="external">https://github.com/mattpker/node-is-master</a></p>
<p>is-master uses an existing mongoose singleton as its “cache”, since most projects I work on already have this running. It is very simple to use; all you need to do is require the module, start the worker process, and then you can check if the process is the master.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'../node_modules/mongoose'</span>);</span><br><span class="line"><span class="keyword">var</span> im = <span class="built_in">require</span>(<span class="string">'../is-master.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start the mongoose db connection</span></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://127.0.0.1:27017/im'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">'\x1b[31m'</span>, <span class="string">'Could not connect to MongoDB!'</span>);</span><br><span class="line">        <span class="keyword">throw</span> (err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start the is-master worker</span></span><br><span class="line">im.start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check if this current process is the master</span></span><br><span class="line"><span class="keyword">if</span> (im.master) &#123;</span><br><span class="line">    <span class="comment">// Do stuff here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This works by inserting each process into your mongodb database, and then whichever process is the oldest is considered the master. Each entry in the mongodb is set to expire if they are not updated within 2 minutes, this way if a process goes offline a new process will be promoted to master.</p>
<p>To setup scheduled tasks with this, you can use setTimeout or setInterval. I highly recommend using setTimeout, setInterval may seem like an easier choice, but it can cause issues if the previous interval got stuck so then you have 2 scheduled tasks running on top of each other.</p>
<p>Here is an example of using setTimeout to scheduled tasks:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cronJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">done</span> = <span class="title">setTimeout</span><span class="params">(function<span class="params">()</span> &#123;</span><br><span class="line">        cronJob<span class="params">()</span>;</span><br><span class="line">    &#125;, <span class="number">120000</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (im.master) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do your work here</span></span><br><span class="line"></span><br><span class="line">        someCallbackFunction(<span class="function"><span class="keyword">function</span><span class="params">(err, results)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// Work with your callback database</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// When you are done make sure to call done</span></span><br><span class="line">            done();</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        done();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">im.on(<span class="string">'connected'</span>, cronjob);</span><br></pre></td></tr></table></figure>
<p>In the example above, the cronJob function will run when is-master emits that is has connected and is ready. The cronJob function will then check if it is master and if it is you can proceed with doing whatever work is necessary. You just need to make sure to call the done() function in every case that it finishes so that it will run again.</p>
<p>If you are looking for more of a cron syntax and style for setting these up, check out the package <a href="https://www.npmjs.com/package/cron" target="_blank" rel="external">https://www.npmjs.com/package/cron</a>. Here is another example using that package:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CronJob = <span class="built_in">require</span>(<span class="string">'cron'</span>).CronJob;</span><br><span class="line"><span class="keyword">var</span> job = <span class="keyword">new</span> CronJob(<span class="string">'0 * * * * *'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (im.master) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do your work here</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="literal">null</span>, <span class="literal">false</span>, <span class="string">"America/Los_Angeles"</span>);</span><br><span class="line"></span><br><span class="line">im.on(<span class="string">'connected'</span>, job.start);</span><br></pre></td></tr></table></figure>
<p>I hope this helps, let me know in the comments if you have any issues or suggestions.</p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/07/06/My-Editor-Atom/">
                My Editor: Atom
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on 2015-07-06
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/06/My-Editor-Atom/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/07/06/My-Editor-Atom/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <center><img src="/images/atom.png" style="border:0px"></center>

<p>Coming from a background in Linux server administration, of course my first editor was Vim. I really like Vim as a basic editor, but when I started programing it really did not fit my needs. I realize that you can highly customize Vim and make it much like “modern” editors of today, this just seemed way to complex for me and I wanted something a bit more user friendly with mouse support.</p>
<p>The editor everyone recommended to me was <a href="http://www.sublimetext.com/" target="_blank" rel="external">Sublime 2</a>. I enjoyed the look and feel of Sublime, but it still did not seem as user friendly that I hoped. Even so, I decided to go ahead with it as it seemed to be the best option at that time.</p>
<p>I used Sublime 2 as my primary editor for about 2 years. I had it very customized to my liking and I was very confortable with it. So changing editors at this point was not even on my radar.</p>
<p>About 6 months ago I stumbled across <a href="https://atom.io/" target="_blank" rel="external">Atom</a>, an editor still in beta from GitHub. It was promising an awesome packaging system, theme support, GitHub support baked in, and powered all by NodeJS and web technologies. At the time I was really getting into NodeJS and decided that I wanted to give it a try to see what it was capable of.</p>
<p><img src="/images/atom2.png" alt="Atom Screenshot" title="Atom Screenshot"></p>
<p>Right out of the box Atom blew me away with an amazing packaging system. Within minutes I found a theme and syntax that I liked and all the comparable plugins I was using in Sublime 2. I felt at home with Atom as it was much like Sublime 2 and most the keyboard shortcuts were the same. It wasn’t till I started coding in an actual Git project that I realized I would not be going back to Sublime 2. It had built in Git support that I had never seen before, such as lines were colored that had been changed/added/deleted and the same thing with new/changed files/folders in the tree view.</p>
<p>Atom recently released <a href="http://blog.atom.io/2015/06/25/atom-1-0.html" target="_blank" rel="external">version 1.0</a> and at this point I would recommend it to everyone. It is extremely stable and they have greatly improved the startup time and speed. I am excited to see what they do next with Atom, hopefully some more great baked in GitHub features and solving the problem of opening very large files (200MB+).</p>
<h2 id="Recommended_Plugins">Recommended Plugins</h2><ul>
<li><a href="https://atom.io/packages/atom-beautify" target="_blank" rel="external">atom-beautify</a></li>
<li><a href="https://atom.io/packages/color-picker" target="_blank" rel="external">color-picker</a></li>
<li><a href="https://atom.io/packages/pigments" target="_blank" rel="external">pigments</a></li>
<li><a href="https://atom.io/packages/file-icons" target="_blank" rel="external">file-icons</a></li>
<li><a href="https://atom.io/packages/linter" target="_blank" rel="external">linter</a> - List of compatible linters <a href="http://atomlinter.github.io/" target="_blank" rel="external">http://atomlinter.github.io/</a></li>
<li><a href="https://atom.io/packages/merge-conflicts" target="_blank" rel="external">merge-conflicts</a></li>
</ul>
<h2 id="Recommended_Theme">Recommended Theme</h2><ul>
<li><a href="https://atom.io/themes/isotope-ui" target="_blank" rel="external">Isotope UI</a></li>
<li><a href="https://atom.io/themes/monokai" target="_blank" rel="external">Monokai Syntax</a></li>
</ul>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/07/06/My-Blog/">
                My Blog
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on 2015-07-06
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/06/My-Blog/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/07/06/My-Blog/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>I am starting a blog based on what I am currently doing in development and technology. I plan on having a new post at least every week. Head on over to the <a href="/about">about</a> page for more information about me.</p>
<p>This blog is being created with <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a> and hosting on <a href="https://pages.github.com/" target="_blank" rel="external">GitHub Pages</a>. I wanted to use a blogging framework that used the same technologies that I am currently working with. When I get more well versed in Hexo, ill make a post reviewing it and even possibly a tutorial.</p>
<p>I am welcome to any feedback, hit me up on my twitter <a href="https://twitter.com/mattpker" target="_blank" rel="external">@mattpker</a> or use the commenting system.</p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
  </div>

  

        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Matt Atkinson" />
          <p class="site-author-name">Matt Atkinson</p>
        </div>
        <p class="site-description motion-element">Personal blog for Matt Atkinson, discusing frontend and backend technologies.</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">categories</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </div>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml">
              <i class="menu-item-icon icon-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/mattpker" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://www.linkedin.com/in/mattpker" target="_blank">LinkedIn</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://twitter.com/mattpker" target="_blank">Twitter</a>
            </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>
        
      </div>

      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Matt Atkinson</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.3"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.3"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.3" id="motion.global"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  
  

  

    <script type="text/javascript">
      var disqus_shortname = 'matkinson';
      var disqus_identifier = 'index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  




  
  
  <script type="text/javascript" src="/js/analytics_google-analytics.js?v=0.4.3"></script>


</body>
</html>
